{"ast":null,"code":"var _jsxFileName = \"D:\\\\\\u0420\\u0430\\u0431\\u043E\\u0447\\u0438\\u0439 \\u0441\\u0442\\u043E\\u043B\\\\\\u0421\\u0430\\u0439\\u0442 \\u043D\\u0430 \\u0434\\u0438\\u043F\\u043B\\u043E\\u043C\\\\Shop_online\\\\client\\\\src\\\\pages\\\\Checkout.js\",\n    _s = $RefreshSig$();\n\nimport { Container, Form, Button, Spinner } from 'react-bootstrap';\nimport { useState, useContext, useEffect } from 'react';\nimport { AppContext } from '../components/AppContext.js';\nimport { userCreate, guestCreate } from '../http/orderAPI.js';\nimport { fetchBasket } from '../http/basketAPI.js';\nimport { check as checkAuth } from '../http/userAPI.js';\nimport { Navigate } from 'react-router-dom';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst isValid = input => {\n  let pattern;\n\n  switch (input.name) {\n    case 'name':\n      pattern = /^[-а-я]{2,}( [-а-я]{2,}){1,2}$/i;\n      return pattern.test(input.value.trim());\n\n    case 'email':\n      pattern = /^[-_.a-z]+@([-a-z]+\\.){1,2}[a-z]+$/i;\n      return pattern.test(input.value.trim());\n\n    case 'phone':\n      pattern = /^[7-8]{1}[0-9]{3}[0-9]{3}[0-9]{2}[0-9]{2}$/i;\n      return pattern.test(input.value.trim());\n\n    case 'address':\n      return input.value.trim() !== '';\n  }\n};\n\nconst Checkout = () => {\n  _s();\n\n  const {\n    user,\n    basket\n  } = useContext(AppContext);\n  const [fetching, setFetching] = useState(true);\n  const [order, setOrder] = useState(null);\n  const [value, setValue] = useState({\n    name: '',\n    email: '',\n    phone: '',\n    address: ''\n  });\n  const [valid, setValid] = useState({\n    name: null,\n    email: null,\n    phone: null,\n    address: null\n  });\n  useEffect(() => {\n    fetchBasket().then(data => basket.products = data.products).finally(() => setFetching(false));\n    checkAuth().then(data => {\n      if (data) {\n        user.login(data);\n      }\n    }).catch(error => user.logout());\n  }, []);\n\n  if (fetching) {\n    return /*#__PURE__*/_jsxDEV(Spinner, {\n      animation: \"border\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 57,\n      columnNumber: 16\n    }, this);\n  }\n\n  if (order) {\n    return /*#__PURE__*/_jsxDEV(Container, {\n      children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n        className: \"area\",\n        children: \"\\u0417\\u0430\\u043A\\u0430\\u0437 \\u043E\\u0444\\u043E\\u0440\\u043C\\u043B\\u0435\\u043D!\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 63,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"area\",\n        style: {\n          fontSize: 30\n        },\n        children: \"\\u041D\\u0430\\u0448 \\u043C\\u0435\\u043D\\u0435\\u0434\\u0436\\u0435\\u0440 \\u0441\\u043A\\u043E\\u0440\\u043E \\u0441\\u0432\\u044F\\u0436\\u0435\\u0442\\u0441\\u044F \\u0441 \\u0412\\u0430\\u043C\\u0438 \\u0434\\u043B\\u044F \\u0443\\u0442\\u043E\\u0447\\u043D\\u0435\\u043D\\u0438\\u044F \\u0434\\u0435\\u0442\\u0430\\u043B\\u0435\\u0439!\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 64,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 62,\n      columnNumber: 13\n    }, this);\n  }\n\n  const handleChange = event => {\n    setValue({ ...value,\n      [event.target.name]: event.target.value\n    });\n    setValid({ ...valid,\n      [event.target.name]: isValid(event.target)\n    });\n  };\n\n  const handleSubmit = event => {\n    event.preventDefault();\n    setValue({\n      name: event.target.name.value.trim(),\n      email: event.target.email.value.trim(),\n      phone: event.target.phone.value.trim(),\n      address: event.target.address.value.trim()\n    });\n    setValid({\n      name: isValid(event.target.name),\n      email: isValid(event.target.email),\n      phone: isValid(event.target.phone),\n      address: isValid(event.target.address)\n    });\n\n    if (valid.name && valid.email && valid.phone && valid.address) {\n      let comment = event.target.comment.value.trim();\n      comment = comment ? comment : null;\n      const body = { ...value,\n        comment\n      };\n      const create = user.isAuth ? userCreate : guestCreate;\n      create(body).then(data => {\n        setOrder(data);\n        basket.products = [];\n      });\n    }\n  };\n\n  return /*#__PURE__*/_jsxDEV(Container, {\n    children: [basket.count === 0 && /*#__PURE__*/_jsxDEV(Navigate, {\n      to: \"/basket\",\n      replace: true\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 111,\n      columnNumber: 36\n    }, this), /*#__PURE__*/_jsxDEV(\"h1\", {\n      className: \"area\",\n      children: \"\\u041E\\u0444\\u043E\\u0440\\u043C\\u043B\\u0435\\u043D\\u0438\\u0435 \\u0437\\u0430\\u043A\\u0430\\u0437\\u0430\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 112,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(Form, {\n      noValidate: true,\n      onSubmit: handleSubmit,\n      children: [/*#__PURE__*/_jsxDEV(Form.Control, {\n        style: {\n          color: '#fd7e14'\n        },\n        name: \"name\",\n        value: value.name,\n        onChange: e => handleChange(e),\n        isValid: valid.name === true,\n        isInvalid: valid.name === false,\n        placeholder: \"\\u0412\\u0432\\u0435\\u0434\\u0438\\u0442\\u0435 \\u0424\\u0418\\u041E...\",\n        className: \"fc\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 114,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(Form.Control, {\n        style: {\n          color: '#fd7e14'\n        },\n        name: \"email\",\n        value: value.email,\n        onChange: e => handleChange(e),\n        isValid: valid.email === true,\n        isInvalid: valid.email === false,\n        placeholder: \"\\u0412\\u0432\\u0435\\u0434\\u0438\\u0442\\u0435 \\u0430\\u0434\\u0440\\u0435\\u0441 \\u044D\\u043B\\u0435\\u043A\\u0442\\u0440\\u043E\\u043D\\u043D\\u043E\\u0439 \\u043F\\u043E\\u0447\\u0442\\u044B...\",\n        className: \"fc\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 123,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(Form.Control, {\n        style: {\n          color: '#fd7e14'\n        },\n        name: \"phone\",\n        value: value.phone,\n        onChange: e => handleChange(e),\n        isValid: valid.phone === true,\n        isInvalid: valid.phone === false,\n        placeholder: \"\\u0412\\u0432\\u0435\\u0434\\u0438\\u0442\\u0435 \\u043D\\u043E\\u043C\\u0435\\u0440 \\u0442\\u0435\\u043B\\u0435\\u0444\\u043E\\u043D\\u0430...\",\n        className: \"fc\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 132,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(Form.Control, {\n        style: {\n          color: '#fd7e14'\n        },\n        name: \"address\",\n        value: value.address,\n        onChange: e => handleChange(e),\n        isValid: valid.address === true,\n        isInvalid: valid.address === false,\n        placeholder: \"\\u0412\\u0432\\u0435\\u0434\\u0438\\u0442\\u0435 \\u0430\\u0434\\u0440\\u0435\\u0441 \\u0434\\u043E\\u0441\\u0442\\u0430\\u0432\\u043A\\u0438...\",\n        className: \"fc\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 141,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(Form.Control, {\n        style: {\n          color: '#fd7e14'\n        },\n        name: \"comment\",\n        className: \"fc\",\n        placeholder: \"\\u041A\\u043E\\u043C\\u043C\\u0435\\u043D\\u0442\\u0430\\u0440\\u0438\\u0439 \\u043A \\u0437\\u0430\\u043A\\u0430\\u0437\\u0443...\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 150,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(Button, {\n        style: {\n          cursor: 'pointer',\n          background: '#fd7e14'\n        },\n        className: \"order2\",\n        type: \"submit\",\n        children: \"\\u041E\\u0442\\u043F\\u0440\\u0430\\u0432\\u0438\\u0442\\u044C\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 155,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 113,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 110,\n    columnNumber: 9\n  }, this);\n};\n\n_s(Checkout, \"5+IS98ceCRVZdcLlkhj2tFUJMoQ=\");\n\n_c = Checkout;\nexport default Checkout;\n\nvar _c;\n\n$RefreshReg$(_c, \"Checkout\");","map":{"version":3,"sources":["D:/Рабочий стол/Сайт на диплом/Shop_online/client/src/pages/Checkout.js"],"names":["Container","Form","Button","Spinner","useState","useContext","useEffect","AppContext","userCreate","guestCreate","fetchBasket","check","checkAuth","Navigate","isValid","input","pattern","name","test","value","trim","Checkout","user","basket","fetching","setFetching","order","setOrder","setValue","email","phone","address","valid","setValid","then","data","products","finally","login","catch","error","logout","fontSize","handleChange","event","target","handleSubmit","preventDefault","comment","body","create","isAuth","count","color","e","cursor","background"],"mappings":"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","sourcesContent":["import { Container, Form, Button, Spinner } from 'react-bootstrap'\nimport { useState, useContext, useEffect } from 'react'\nimport { AppContext } from '../components/AppContext.js'\nimport { userCreate, guestCreate } from '../http/orderAPI.js'\nimport { fetchBasket } from '../http/basketAPI.js'\nimport { check as checkAuth } from '../http/userAPI.js'\nimport { Navigate } from 'react-router-dom'\n\nconst isValid = (input) => {\n    let pattern\n    switch (input.name) {\n        case 'name':\n            pattern = /^[-а-я]{2,}( [-а-я]{2,}){1,2}$/i\n            return pattern.test(input.value.trim())\n        case 'email':\n            pattern = /^[-_.a-z]+@([-a-z]+\\.){1,2}[a-z]+$/i\n            return pattern.test(input.value.trim())\n        case 'phone':\n            pattern = /^[7-8]{1}[0-9]{3}[0-9]{3}[0-9]{2}[0-9]{2}$/i\n            return pattern.test(input.value.trim())\n        case 'address':\n            return input.value.trim() !== ''\n    }\n}\n\nconst Checkout = () => {\n    const { user, basket } = useContext(AppContext)\n    const [fetching, setFetching] = useState(true) \n\n    const [order, setOrder] = useState(null)\n\n    const [value, setValue] = useState({name: '', email: '', phone: '', address: ''})\n    const [valid, setValid] = useState({name: null, email: null, phone: null, address: null})\n\n    useEffect(() => {\n       \n        fetchBasket()\n            .then(\n                data => basket.products = data.products\n            )\n            .finally(\n                () => setFetching(false)\n            )\n       \n        checkAuth()\n            .then(data => {\n                if (data) {\n                    user.login(data)\n                }\n            })\n            .catch(\n                error => user.logout()\n            )\n    }, [])\n\n    if (fetching) { \n        return <Spinner animation=\"border\" />\n    }\n\n    if (order) {\n        return (\n            <Container>\n                <h1 className=\"area\">Заказ оформлен!</h1>\n                <p className=\"area\" style={{ fontSize: 30}}>Наш менеджер скоро свяжется с Вами для уточнения деталей!</p>\n            </Container>\n        )\n    }\n\n    const handleChange = (event) => {\n        setValue({...value, [event.target.name]: event.target.value})\n      \n        setValid({...valid, [event.target.name]: isValid(event.target)})\n    }\n\n    const handleSubmit = (event) => {\n        event.preventDefault()\n\n        setValue({\n            name: event.target.name.value.trim(),\n            email: event.target.email.value.trim(),\n            phone: event.target.phone.value.trim(),\n            address: event.target.address.value.trim(),\n        })\n\n        setValid({\n            name: isValid(event.target.name),\n            email: isValid(event.target.email),\n            phone: isValid(event.target.phone),\n            address: isValid(event.target.address)\n            \n        })\n\n        if (valid.name && valid.email && valid.phone && valid.address ) {\n            let comment = event.target.comment.value.trim()\n            comment = comment ? comment : null\n          \n            const body = {...value, comment}\n            const create = user.isAuth ? userCreate : guestCreate\n            create(body)\n                .then(\n                    data => {\n                        setOrder(data)\n                        basket.products = []\n                    }\n                )\n        }\n    }\n\n    return (\n        <Container>\n            {basket.count === 0 && <Navigate to=\"/basket\" replace={true} />}\n            <h1 className='area'>Оформление заказа</h1>\n            <Form noValidate onSubmit={handleSubmit}>\n                <Form.Control style= {{color: '#fd7e14'}}\n                    name=\"name\"\n                    value={value.name}\n                    onChange={e => handleChange(e)}\n                    isValid={valid.name === true}\n                    isInvalid={valid.name === false}\n                    placeholder=\"Введите ФИО...\"\n                    className='fc'\n                />\n                <Form.Control style= {{color: '#fd7e14'}}\n                    name=\"email\"\n                    value={value.email}\n                    onChange={e => handleChange(e)}\n                    isValid={valid.email === true}\n                    isInvalid={valid.email === false}\n                    placeholder=\"Введите адрес электронной почты...\"\n                    className='fc'\n                />\n                <Form.Control style= {{color: '#fd7e14'}}\n                    name=\"phone\"\n                    value={value.phone}\n                    onChange={e => handleChange(e)}\n                    isValid={valid.phone === true}\n                    isInvalid={valid.phone === false}\n                    placeholder=\"Введите номер телефона...\"\n                    className='fc'\n                />\n                <Form.Control style= {{color: '#fd7e14'}}\n                    name=\"address\"\n                    value={value.address}\n                    onChange={e => handleChange(e)}\n                    isValid={valid.address === true}\n                    isInvalid={valid.address === false}\n                    placeholder=\"Введите адрес доставки...\"\n                    className='fc'\n                />\n                <Form.Control style= {{color: '#fd7e14'}}\n                    name=\"comment\"\n                    className='fc'\n                    placeholder=\"Комментарий к заказу...\"\n                />\n                <Button style={{cursor: 'pointer', background: '#fd7e14'}} className='order2' type=\"submit\">Отправить</Button>\n            </Form>\n        </Container>\n    )\n}\n\nexport default Checkout"]},"metadata":{},"sourceType":"module"}